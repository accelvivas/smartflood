<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Smart Flood Detection System - National University Lipa</title>
    
    <!-- iOS Web App Capabilities -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Smart Flood">
    <meta name="theme-color" content="#1e4a7a">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- Feather Icons -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    <!-- Leaflet CSS/JS for interactive maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- Site Icon -->
    <link rel="icon" type="image/png" href="images/logo.png" />
    <link rel="apple-touch-icon" href="images/logo.png" />
    
    <style>
        /* Custom CSS Variables */
        :root {
            --navy-blue: #1e4a7a;
            --bright-cyan: #00bcd4;
            --light-cyan: #4dd0e1;
            --mint-green: #8bc34a;
            --lime-green: #9ccc65;
            --background: #f5f9fc;
            --foreground: #1a2332;
            --primary: #1e4a7a;
            --secondary: #00bcd4;
            --accent: #8bc34a;
            --destructive: #e53935;
            --muted: #e8f4f8;
            --muted-foreground: #546e7a;
        }

        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(to bottom right, #f5f9fc, #f5f9fc, rgba(0, 188, 212, 0.05));
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Mobile-optimized scrolling */
        html {
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        /* Prevent horizontal overflow */
        html, body {
            max-width: 100vw;
            overflow-x: hidden;
        }

        .decorative-bg {
            position: fixed;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        .decorative-bg::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(0, 188, 212, 0.15), transparent);
            filter: blur(60px);
        }

        .decorative-bg::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(139, 195, 74, 0.15), transparent);
            filter: blur(60px);
        }

        @media (min-width: 768px) {
            .decorative-bg::before,
            .decorative-bg::after {
                width: 384px;
                height: 384px;
            }
        }

        .gradient-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }

        @media (min-width: 640px) {
            .gradient-header {
                padding: 2rem;
            }
        }

        .metric-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.25rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-top: 4px solid transparent;
            transition: all 0.3s ease;
            min-height: 120px;
        }

        @media (min-width: 640px) {
            .metric-card {
                padding: 1.5rem;
            }
        }

        .metric-card:active {
            transform: scale(0.98);
        }

        .chart-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.25rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--secondary);
        }

        @media (min-width: 640px) {
            .chart-card {
                padding: 1.5rem;
            }
        }

        .risk-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.375rem 0.875rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            border: 1px solid;
        }

        .risk-badge.low {
            background: rgba(139, 195, 74, 0.2);
            color: #689f38;
            border-color: rgba(139, 195, 74, 0.3);
        }

        .risk-badge.medium {
            background: rgba(255, 193, 7, 0.2);
            color: #f57c00;
            border-color: rgba(255, 193, 7, 0.3);
        }

        .risk-badge.high {
            background: rgba(229, 57, 53, 0.2);
            color: #c62828;
            border-color: rgba(229, 57, 53, 0.3);
        }

        /* Mobile-optimized buttons (44x44px minimum touch target) */
        .nav-button {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: none;
            background: transparent;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: all 0.2s;
            color: var(--foreground);
            min-height: 44px;
            font-size: 0.9375rem;
        }

        .nav-button:active {
            transform: scale(0.95);
        }

        .nav-button.active {
            background: linear-gradient(135deg, var(--primary), rgba(30, 74, 122, 0.9));
            color: white;
            box-shadow: 0 4px 12px rgba(30, 74, 122, 0.3);
        }

        .alert-box {
            padding: 1rem;
            border-radius: 0.5rem;
            border-left: 4px solid;
            margin-bottom: 1rem;
        }

        .alert-box.warning {
            background: linear-gradient(to right, rgba(255, 193, 7, 0.1), transparent);
            border-color: #ffc107;
        }

        .alert-box.info {
            background: linear-gradient(to right, rgba(0, 188, 212, 0.1), transparent);
            border-color: var(--secondary);
        }

        .hidden {
            display: none !important;
        }

        .progress-bar {
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        /* Mobile Navigation */
        @media (max-width: 768px) {
            .nav-desktop {
                display: none;
            }
            
            .gradient-header h1 {
                font-size: 1.5rem !important;
            }
            
            /* Improve readability on mobile */
            body {
                font-size: 16px; /* Prevent iOS zoom on input focus */
            }
        }

        @media (min-width: 769px) {
            .nav-mobile, .mobile-menu-toggle {
                display: none !important;
            }
        }

        /* Responsive grids */
        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        @media (min-width: 640px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .metrics-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {
            .charts-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .map-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 1024px) {
            .map-grid {
                grid-template-columns: 2fr 1fr;
            }
        }

        /* Map optimizations for mobile */
        #leafletMap {
            height: 400px !important;
            border-radius: 0.5rem;
            overflow: hidden;
            touch-action: pan-x pan-y;
        }

        @media (min-width: 640px) {
            #leafletMap {
                height: 500px !important;
            }
        }

        /* Leaflet custom styles */
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .leaflet-popup-tip {
            background: white;
        }
        
        .custom-marker {
            background: transparent;
            border: none;
        }
        
        .leaflet-container a.leaflet-popup-close-button {
            font-size: 24px;
            padding: 8px;
            width: 32px;
            height: 32px;
        }

        /* Better touch targets for mobile */
        button, a, .clickable {
            min-height: 44px;
            min-width: 44px;
        }

        /* Prevent text selection on buttons */
        button {
            -webkit-user-select: none;
            user-select: none;
        }

        /* Responsive images */
        img {
            max-width: 100%;
            height: auto;
        }

        /* Footer responsive */
        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        @media (min-width: 768px) {
            .footer-content {
                flex-direction: row;
            }
        }

        /* Smooth animations */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Loading state */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* iOS safe area support */
        @supports (padding-top: env(safe-area-inset-top)) {
            header {
                padding-top: max(1rem, env(safe-area-inset-top));
            }
            
            footer {
                padding-bottom: max(1rem, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <!-- Decorative Background -->
    <div class="decorative-bg"></div>

    <!-- Main Container -->
    <div style="position: relative; z-index: 1;">
        <!-- Header -->
        <header style="position: sticky; top: 0; z-index: 50; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(30, 74, 122, 0.12); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);">
            <div style="max-width: 1280px; margin: 0 auto; padding: 0.75rem 1rem;">
                <div style="display: flex; align-items: center; justify-content: space-between; min-height: 64px;">
                    <!-- Logo Section -->
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <img src="images/logo.png" 
                             alt="Smart Flood Logo" style="width: 48px; height: 48px; flex-shrink: 0;">
                        <div>
                            <h2 style="font-size: 1.125rem; color: var(--primary); font-weight: 600; margin: 0; line-height: 1.2;">Smart Flood Detection</h2>
                            <p style="font-size: 0.75rem; color: var(--muted-foreground); margin: 0;">Philippine Monitoring System</p>
                        </div>
                    </div>
                    
                    <!-- Mobile Menu Toggle -->
                    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" 
                            style="background: transparent; border: none; cursor: pointer; padding: 0.75rem; min-width: 44px; min-height: 44px; display: flex; align-items: center; justify-content: center;">
                        <i data-feather="menu" style="width: 24px; height: 24px;"></i>
                    </button>

                    <!-- Desktop Navigation -->
                    <nav class="nav-desktop" style="display: flex; align-items: center; gap: 0.5rem; background: rgba(232, 244, 248, 0.5); padding: 0.375rem; border-radius: 0.75rem;">
                        <button class="nav-button active" onclick="switchTab('dashboard')" id="nav-dashboard">
                            <i data-feather="layout" style="width: 18px; height: 18px;"></i>
                            <span>Dashboard</span>
                        </button>
                        <button class="nav-button" onclick="switchTab('map')" id="nav-map">
                            <i data-feather="map" style="width: 18px; height: 18px;"></i>
                            <span>Map</span>
                        </button>
                        <button class="nav-button" onclick="switchTab('predictions')" id="nav-predictions">
                            <i data-feather="cpu" style="width: 18px; height: 18px;"></i>
                            <span>Predictions</span>
                        </button>
                        <button class="nav-button" onclick="switchTab('alerts')" id="nav-alerts">
                            <i data-feather="bell" style="width: 18px; height: 18px;"></i>
                            <span>Alerts</span>
                        </button>
                    </nav>
                </div>

                <!-- Mobile Navigation -->
                <div id="mobileMenu" class="nav-mobile hidden" style="border-top: 1px solid rgba(30, 74, 122, 0.12); padding: 1rem 0; background: #f5f9fc; margin: 0 -1rem;">
                    <div style="padding: 0 1rem; display: flex; flex-direction: column; gap: 0.5rem;">
                        <button class="nav-button active" onclick="switchTab('dashboard'); toggleMobileMenu();" style="width: 100%; justify-content: flex-start;">
                            <i data-feather="layout" style="width: 20px; height: 20px;"></i>
                            Dashboard
                        </button>
                        <button class="nav-button" onclick="switchTab('map'); toggleMobileMenu();" style="width: 100%; justify-content: flex-start;">
                            <i data-feather="map" style="width: 20px; height: 20px;"></i>
                            Map View
                        </button>
                        <button class="nav-button" onclick="switchTab('predictions'); toggleMobileMenu();" style="width: 100%; justify-content: flex-start;">
                            <i data-feather="cpu" style="width: 20px; height: 20px;"></i>
                            Predictions
                        </button>
                        <button class="nav-button" onclick="switchTab('alerts'); toggleMobileMenu();" style="width: 100%; justify-content: flex-start;">
                            <i data-feather="bell" style="width: 20px; height: 20px;"></i>
                            Alerts
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main style="max-width: 1280px; margin: 0 auto; padding: 1.5rem 1rem;">
            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content">
                <!-- Gradient Header -->
                <div class="gradient-header">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                        <i data-feather="droplet" style="width: 28px; height: 28px;"></i>
                        <h1 style="font-size: 1.75rem; margin: 0; color: white; line-height: 1.2;">Smart Flood Detection Dashboard</h1>
                    </div>
                    <p style="margin: 0; opacity: 0.95; font-size: 0.9375rem;">Real-time monitoring and prediction for flood-prone areas in the Philippines</p>
                </div>

                <!-- Recent Alerts -->
                <div class="alert-box warning">
                    <div style="display: flex; align-items: start; gap: 0.75rem;">
                        <i data-feather="alert-triangle" style="width: 20px; height: 20px; color: #f57c00; flex-shrink: 0;"></i>
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 0.25rem 0; color: #f57c00; font-size: 0.9375rem;">Barangay San Jose</h4>
                            <p style="margin: 0; font-size: 0.875rem; color: var(--foreground);">High flood risk detected. Expected water level: 3.2m • 10 minutes ago</p>
                        </div>
                    </div>
                </div>

                <div class="alert-box info">
                    <div style="display: flex; align-items: start; gap: 0.75rem;">
                        <i data-feather="info" style="width: 20px; height: 20px; color: var(--secondary); flex-shrink: 0;"></i>
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 0.25rem 0; color: var(--secondary); font-size: 0.9375rem;">Barangay Poblacion</h4>
                            <p style="margin: 0; font-size: 0.875rem; color: var(--foreground);">Heavy rainfall forecast for next 6 hours • 25 minutes ago</p>
                        </div>
                    </div>
                </div>

                <!-- Metrics Grid -->
                <div class="metrics-grid" style="margin-bottom: 1.5rem;">
                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Current Rainfall</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="cloud-rain" style="width: 20px; height: 20px; color: var(--secondary);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.75rem; font-weight: 600;">15.2 mm/hr</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: #e53935;">+23% from last hour</p>
                    </div>

                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Average Water Level</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="activity" style="width: 20px; height: 20px; color: var(--primary);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.75rem; font-weight: 600;">2.3 meters</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: #e53935;">Above normal threshold</p>
                    </div>

                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Active Sensors</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="radio" style="width: 20px; height: 20px; color: var(--accent);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.75rem; font-weight: 600;">12 / 15</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--muted-foreground);">3 sensors offline</p>
                    </div>

                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">High Risk Areas</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="alert-triangle" style="width: 20px; height: 20px; color: var(--destructive);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.75rem; font-weight: 600;">3 locations</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: #e53935;">2 new alerts today</p>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-grid" style="margin-bottom: 1.5rem;">
                    <div class="chart-card">
                        <div style="margin-bottom: 1rem;">
                            <h3 style="margin: 0 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.125rem;">
                                <i data-feather="cloud-rain" style="width: 20px; height: 20px; color: var(--secondary);"></i>
                                Rainfall (24h)
                            </h3>
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Actual vs Forecast</p>
                        </div>
                        <div style="position: relative; height: 250px;">
                            <canvas id="rainfallChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card" style="border-left-color: var(--primary);">
                        <div style="margin-bottom: 1rem;">
                            <h3 style="margin: 0 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.125rem;">
                                <i data-feather="activity" style="width: 20px; height: 20px; color: var(--primary);"></i>
                                Water Level (24h)
                            </h3>
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">River gauge readings</p>
                        </div>
                        <div style="position: relative; height: 250px;">
                            <canvas id="waterLevelChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Predictions Table -->
                <div class="chart-card" style="border-left-color: var(--accent);">
                    <div style="margin-bottom: 1rem;">
                        <h3 style="margin: 0 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.125rem;">
                            <i data-feather="cpu" style="width: 20px; height: 20px; color: var(--accent);"></i>
                            Flood Risk Predictions
                        </h3>
                        <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">ML-based flood likelihood predictions</p>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <!-- Prediction items will be generated dynamically -->
                        <div id="predictionsList"></div>
                    </div>
                </div>
            </div>

            <!-- Map Tab -->
            <div id="map-tab" class="tab-content hidden">
                <div class="gradient-header">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                        <i data-feather="map-pin" style="width: 28px; height: 28px;"></i>
                        <h1 style="font-size: 1.75rem; margin: 0; color: white; line-height: 1.2;">Flood Risk Map</h1>
                    </div>
                    <p style="margin: 0; opacity: 0.95; font-size: 0.9375rem;">Interactive map showing sensor locations and risk zones</p>
                </div>

                <div class="map-grid">
                    <!-- Map Card -->
                    <div class="chart-card">
                        <div style="margin-bottom: 1rem;">
                            <h3 style="margin: 0 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.125rem;">
                                <i data-feather="navigation" style="width: 20px; height: 20px; color: var(--secondary);"></i>
                                Sensor Network Map
                            </h3>
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Tap markers for details</p>
                        </div>
                        
                        <div id="leafletMap" style="border: 1px solid rgba(0, 188, 212, 0.2);"></div>
                    </div>

                    <!-- Sensor Details -->
                    <div class="chart-card" style="border-left-color: var(--primary);">
                        <div style="margin-bottom: 1rem;">
                            <h3 style="margin: 0 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.125rem;">
                                <i data-feather="radio" style="width: 20px; height: 20px; color: var(--primary);"></i>
                                Sensor Details
                            </h3>
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);" id="sensorDetailsDesc">Tap a sensor to view details</p>
                        </div>
                        
                        <div id="sensorDetails">
                            <div style="text-align: center; padding: 2rem 1rem; color: var(--muted-foreground);">
                                <i data-feather="map-pin" style="width: 48px; height: 48px; opacity: 0.5; margin: 0 auto 1rem;"></i>
                                <p style="margin: 0; font-size: 0.875rem;">Select a sensor on the map to view detailed information</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- All Sensors List -->
                <div class="chart-card" style="margin-top: 1.5rem;">
                    <div style="margin-bottom: 1rem;">
                        <h3 style="margin: 0 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.125rem;">
                            <i data-feather="radio" style="width: 20px; height: 20px; color: var(--primary);"></i>
                            All Sensors
                        </h3>
                        <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Overview of all monitored sensors</p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr; gap: 0.75rem;" id="allSensorsList"></div>
                </div>
            </div>

            <!-- Predictions Tab -->
            <div id="predictions-tab" class="tab-content hidden">
                <div class="gradient-header">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                        <i data-feather="cpu" style="width: 28px; height: 28px;"></i>
                        <h1 style="font-size: 1.75rem; margin: 0; color: white; line-height: 1.2;">ML Prediction Console</h1>
                    </div>
                    <p style="margin: 0; opacity: 0.95; font-size: 0.9375rem;">Machine learning model performance and flood forecasts</p>
                </div>

                <!-- Model Metrics -->
                <div class="metrics-grid" style="margin-bottom: 1.5rem;">
                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Model Accuracy</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="target" style="width: 20px; height: 20px; color: var(--accent);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.75rem; font-weight: 600;">93.2%</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 93.2%; background: var(--accent);"></div>
                        </div>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--accent);">+2.3% from last month</p>
                    </div>

                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Predictions Today</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="activity" style="width: 20px; height: 20px; color: var(--secondary);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.75rem; font-weight: 600;">248</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--muted-foreground);">Every 15 minutes</p>
                    </div>

                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Training Data</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="database" style="width: 20px; height: 20px; color: var(--primary);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.75rem; font-weight: 600;">15,432</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--muted-foreground);">Historical records</p>
                    </div>

                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Last Retrained</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="calendar" style="width: 20px; height: 20px; color: #f57c00;"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.75rem; font-weight: 600;">3 days</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--muted-foreground);">Next: in 4 days</p>
                    </div>
                </div>

                <!-- Forecast Chart -->
                <div class="chart-card">
                    <div style="margin-bottom: 1rem;">
                        <h3 style="margin: 0 0 0.25rem 0; font-size: 1.125rem;">48-Hour Flood Risk Forecast</h3>
                        <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">ML-based predictions</p>
                    </div>
                    <div style="position: relative; height: 250px;">
                        <canvas id="forecastChart"></canvas>
                    </div>
                </div>

                <!-- Model Info -->
                <div class="chart-card" style="margin-top: 1.5rem;">
                    <div style="margin-bottom: 1rem;">
                        <h3 style="margin: 0 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.125rem;">
                            <i data-feather="cpu" style="width: 20px; height: 20px; color: var(--accent);"></i>
                            Model Information
                        </h3>
                        <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Current production model details</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75rem; margin-bottom: 1rem;">
                        <div style="padding: 0.75rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem;">
                            <p style="margin: 0 0 0.25rem 0; font-size: 0.75rem; color: var(--muted-foreground);">Algorithm</p>
                            <p style="margin: 0; font-size: 0.875rem;">XGBoost</p>
                        </div>
                        <div style="padding: 0.75rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem;">
                            <p style="margin: 0 0 0.25rem 0; font-size: 0.75rem; color: var(--muted-foreground);">Version</p>
                            <p style="margin: 0; font-size: 0.875rem;">v2.4.1</p>
                        </div>
                        <div style="padding: 0.75rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem;">
                            <p style="margin: 0 0 0.25rem 0; font-size: 0.75rem; color: var(--muted-foreground);">Features</p>
                            <p style="margin: 0; font-size: 0.875rem;">24 variables</p>
                        </div>
                        <div style="padding: 0.75rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem;">
                            <p style="margin: 0 0 0.25rem 0; font-size: 0.75rem; color: var(--muted-foreground);">Speed</p>
                            <p style="margin: 0; font-size: 0.875rem;">~0.3s</p>
                        </div>
                    </div>

                    <div style="padding: 1rem; background: rgba(0, 188, 212, 0.1); border: 1px solid rgba(0, 188, 212, 0.2); border-radius: 0.5rem;">
                        <div style="display: flex; align-items: start; gap: 0.75rem;">
                            <i data-feather="cpu" style="width: 20px; height: 20px; color: var(--secondary); flex-shrink: 0; margin-top: 0.125rem;"></i>
                            <div>
                                <h4 style="margin: 0 0 0.5rem 0; font-size: 0.875rem;">Model Description</h4>
                                <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">
                                    Uses gradient boosting to predict flood likelihood based on 
                                    meteorological data, water level sensors, and historical flood patterns.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alerts Tab -->
            <div id="alerts-tab" class="tab-content hidden">
                <div class="gradient-header">
                    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <i data-feather="bell" style="width: 28px; height: 28px;"></i>
                                <h1 style="font-size: 1.75rem; margin: 0; color: white; line-height: 1.2;">Alert Management</h1>
                            </div>
                            <p style="margin: 0; opacity: 0.95; font-size: 0.9375rem;">Manage flood warnings and notifications</p>
                        </div>
                        <button style="background: white; color: var(--primary); border: none; padding: 0.75rem 1.25rem; border-radius: 0.5rem; cursor: pointer; display: inline-flex; align-items: center; gap: 0.5rem; font-weight: 500; min-height: 44px;">
                            <i data-feather="settings" style="width: 18px; height: 18px;"></i>
                            Settings
                        </button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="metrics-grid" style="margin-bottom: 1.5rem;">
                    <div class="metric-card" style="border-top-color: var(--destructive);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Active Alerts</p>
                            <div style="background: rgba(229, 57, 53, 0.1); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="bell" style="width: 20px; height: 20px; color: var(--destructive);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.75rem; font-weight: 600;">3</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--destructive);">2 critical alerts</p>
                    </div>

                    <div class="metric-card" style="border-top-color: var(--secondary);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Total Recipients</p>
                            <div style="background: rgba(0, 188, 212, 0.1); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="message-square" style="width: 20px; height: 20px; color: var(--secondary);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.75rem; font-weight: 600;">987</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--muted-foreground);">All locations</p>
                    </div>

                    <div class="metric-card" style="border-top-color: var(--accent);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Messages (24h)</p>
                            <div style="background: rgba(139, 195, 74, 0.1); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="mail" style="width: 20px; height: 20px; color: var(--accent);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.75rem; font-weight: 600;">1,254</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--accent);">98.5% delivered</p>
                    </div>
                </div>

                <!-- Active Alerts List -->
                <div class="chart-card">
                    <div style="margin-bottom: 1rem;">
                        <h3 style="margin: 0 0 0.25rem 0; font-size: 1.125rem;">Current Active Alerts</h3>
                        <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Real-time flood warnings requiring attention</p>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div class="alert-box" style="border-color: var(--destructive); background: linear-gradient(to right, rgba(229, 57, 53, 0.1), transparent);">
                            <div style="display: flex; align-items: start; gap: 0.75rem;">
                                <i data-feather="alert-triangle" style="width: 20px; height: 20px; color: var(--destructive); flex-shrink: 0; margin-top: 0.125rem;"></i>
                                <div style="flex: 1;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem; flex-wrap: wrap; gap: 0.5rem;">
                                        <h4 style="margin: 0; color: var(--destructive); font-size: 0.9375rem;">Barangay San Jose</h4>
                                        <span class="risk-badge high" style="font-size: 0.75rem; padding: 0.25rem 0.625rem;">HIGH</span>
                                    </div>
                                    <p style="margin: 0 0 0.5rem 0; font-size: 0.875rem;">Critical water level detected. Immediate evacuation recommended.</p>
                                    <div style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; font-size: 0.75rem; color: var(--muted-foreground);">
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            <i data-feather="clock" style="width: 12px; height: 12px;"></i>
                                            5 min ago
                                        </span>
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            <i data-feather="message-square" style="width: 12px; height: 12px;"></i>
                                            342 recipients
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert-box" style="border-color: #ffc107; background: linear-gradient(to right, rgba(255, 193, 7, 0.1), transparent);">
                            <div style="display: flex; align-items: start; gap: 0.75rem;">
                                <i data-feather="alert-circle" style="width: 20px; height: 20px; color: #f57c00; flex-shrink: 0; margin-top: 0.125rem;"></i>
                                <div style="flex: 1;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem; flex-wrap: wrap; gap: 0.5rem;">
                                        <h4 style="margin: 0; color: #f57c00; font-size: 0.9375rem;">Barangay Santa Cruz</h4>
                                        <span class="risk-badge medium" style="font-size: 0.75rem; padding: 0.25rem 0.625rem;">MEDIUM</span>
                                    </div>
                                    <p style="margin: 0 0 0.5rem 0; font-size: 0.875rem;">Heavy rainfall forecast. Monitor water levels closely.</p>
                                    <div style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; font-size: 0.75rem; color: var(--muted-foreground);">
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            <i data-feather="clock" style="width: 12px; height: 12px;"></i>
                                            18 min ago
                                        </span>
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            <i data-feather="message-square" style="width: 12px; height: 12px;"></i>
                                            189 recipients
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert-box" style="border-color: var(--destructive); background: linear-gradient(to right, rgba(229, 57, 53, 0.1), transparent);">
                            <div style="display: flex; align-items: start; gap: 0.75rem;">
                                <i data-feather="alert-triangle" style="width: 20px; height: 20px; color: var(--destructive); flex-shrink: 0; margin-top: 0.125rem;"></i>
                                <div style="flex: 1;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem; flex-wrap: wrap; gap: 0.5rem;">
                                        <h4 style="margin: 0; color: var(--destructive); font-size: 0.9375rem;">Barangay Poblacion</h4>
                                        <span class="risk-badge high" style="font-size: 0.75rem; padding: 0.25rem 0.625rem;">HIGH</span>
                                    </div>
                                    <p style="margin: 0 0 0.5rem 0; font-size: 0.875rem;">Water level rising rapidly. Prepare for evacuation.</p>
                                    <div style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; font-size: 0.75rem; color: var(--muted-foreground);">
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            <i data-feather="clock" style="width: 12px; height: 12px;"></i>
                                            32 min ago
                                        </span>
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            <i data-feather="message-square" style="width: 12px; height: 12px;"></i>
                                            456 recipients
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer style="border-top: 1px solid rgba(30, 74, 122, 0.12); margin-top: 2rem; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(8px); position: relative; z-index: 10;">
            <div style="max-width: 1280px; margin: 0 auto; padding: 1.5rem 1rem;">
                <div class="footer-content">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <img src="images/logo.png" 
                             alt="Smart Flood Logo" style="width: 40px; height: 40px; flex-shrink: 0;">
                        <div>
                            <p style="margin: 0; font-size: 0.875rem;">© 2025 Smart Flood Detection System</p>
                            <p style="margin: 0; font-size: 0.75rem; color: var(--muted-foreground);">National University - Lipa</p>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Capstone Project</p>
                        <p style="margin: 0; font-size: 0.75rem; color: var(--muted-foreground);">Alcantara • Hernandez • Tan • Viray</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Sensor Data
        const sensors = [
            { id: 1, name: 'San Jose River Station', status: 'online', waterLevel: 2.8, riskLevel: 'high', lat: 13.9411, lng: 121.1634 },
            { id: 2, name: 'Santa Cruz Bridge', status: 'online', waterLevel: 1.9, riskLevel: 'medium', lat: 13.9475, lng: 121.1580 },
            { id: 3, name: 'Poblacion Center', status: 'offline', waterLevel: 0, riskLevel: 'low', lat: 13.9380, lng: 121.1700 },
            { id: 4, name: 'Riverside Park Sensor', status: 'online', waterLevel: 1.2, riskLevel: 'low', lat: 13.9520, lng: 121.1650 },
            { id: 5, name: 'Central Plaza Monitor', status: 'online', waterLevel: 2.1, riskLevel: 'medium', lat: 13.9350, lng: 121.1620 },
            { id: 6, name: 'Barangay Hall Sensor', status: 'online', waterLevel: 1.5, riskLevel: 'low', lat: 13.9450, lng: 121.1720 },
            { id: 7, name: 'Market Area Station', status: 'online', waterLevel: 2.4, riskLevel: 'high', lat: 13.9320, lng: 121.1580 }
        ];

        const predictions = [
            { location: 'Barangay San Jose', risk: 'high', probability: 87 },
            { location: 'Barangay Santa Cruz', risk: 'medium', probability: 62 },
            { location: 'Barangay Poblacion', risk: 'high', probability: 78 },
            { location: 'Barangay Riverside', risk: 'low', probability: 34 },
            { location: 'Barangay Central', risk: 'medium', probability: 55 }
        ];

        // Global variables
        let map = null;
        let markers = [];
        let rainfallChart, waterLevelChart, forecastChart;

        // Tab Navigation
        function switchTab(tabName) {
            const tabs = ['dashboard', 'map', 'predictions', 'alerts'];
            tabs.forEach(tab => {
                document.getElementById(`${tab}-tab`).classList.add('hidden');
                const navBtn = document.getElementById(`nav-${tab}`);
                if (navBtn) navBtn.classList.remove('active');
                
                // Update mobile nav
                const mobileButtons = document.querySelectorAll('.nav-mobile button');
                mobileButtons.forEach(btn => {
                    if (btn.textContent.toLowerCase().includes(tab.replace('-', ' '))) {
                        btn.classList.remove('active');
                    }
                });
            });

            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            const activeBtn = document.getElementById(`nav-${tabName}`);
            if (activeBtn) activeBtn.classList.add('active');

            feather.replace();

            if (tabName === 'dashboard') {
                renderPredictions();
                initDashboardCharts();
            } else if (tabName === 'predictions') {
                initPredictionCharts();
            } else if (tabName === 'map') {
                renderAllSensors();
                setTimeout(() => initLeafletMap(), 100);
            }
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
            feather.replace();
        }

        // Render predictions list
        function renderPredictions() {
            const container = document.getElementById('predictionsList');
            if (!container) return;

            const html = predictions.map(p => {
                const riskClass = p.risk === 'high' ? 'high' : p.risk === 'medium' ? 'medium' : 'low';
                const barColor = p.risk === 'high' ? '#e53935' : p.risk === 'medium' ? '#ffc107' : '#8bc34a';
                
                return `
                    <div style="display: flex; flex-direction: column; gap: 0.75rem; padding: 1rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 0.5rem;">
                            <h4 style="margin: 0; font-size: 0.9375rem;">${p.location}</h4>
                            <span class="risk-badge ${riskClass}" style="font-size: 0.75rem; padding: 0.25rem 0.625rem;">
                                ${p.risk.toUpperCase()} RISK
                            </span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="flex: 1; height: 10px; background: #e0e0e0; border-radius: 5px; overflow: hidden;">
                                <div style="height: 100%; width: ${p.probability}%; background: ${barColor}; transition: width 0.5s ease;"></div>
                            </div>
                            <span style="font-size: 0.875rem; font-weight: 600; min-width: 45px;">${p.probability}%</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        // Sensor selection
        function selectSensor(sensorId) {
            const sensor = sensors.find(s => s.id === sensorId);
            if (!sensor) return;

            const detailsDiv = document.getElementById('sensorDetails');
            const descP = document.getElementById('sensorDetailsDesc');
            
            descP.textContent = 'Selected sensor information';

            const riskBadgeClass = sensor.riskLevel;
            const statusIcon = sensor.status === 'online' ? 'wifi' : 'wifi-off';
            const waterLevelPercent = sensor.waterLevel > 0 ? Math.min((sensor.waterLevel / 2.5) * 100, 100) : 0;
            const progressColor = sensor.riskLevel === 'high' ? '#e53935' : sensor.riskLevel === 'medium' ? '#ffc107' : '#8bc34a';

            detailsDiv.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <h4 style="margin: 0 0 0.75rem 0; font-size: 1rem;">${sensor.name}</h4>
                    <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
                        <span class="risk-badge ${riskBadgeClass}" style="font-size: 0.75rem;">${sensor.riskLevel.toUpperCase()}</span>
                        <span style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.625rem; background: ${sensor.status === 'online' ? 'rgba(0, 188, 212, 0.15)' : 'rgba(0,0,0,0.05)'}; color: ${sensor.status === 'online' ? 'var(--secondary)' : 'var(--muted-foreground)'}; border-radius: 9999px; font-size: 0.75rem;">
                            <i data-feather="${statusIcon}" style="width: 12px; height: 12px;"></i>
                            ${sensor.status}
                        </span>
                    </div>
                </div>

                <div style="display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(30, 74, 122, 0.12);">
                        <span style="font-size: 0.875rem; color: var(--muted-foreground);">Water Level</span>
                        <span style="font-weight: 600;">${sensor.waterLevel.toFixed(1)}m</span>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(30, 74, 122, 0.12);">
                        <span style="font-size: 0.875rem; color: var(--muted-foreground);">Critical Threshold</span>
                        <span style="font-weight: 600; color: #e53935;">2.5m</span>
                    </div>

                    <div style="display: flex; justify-content: space-between; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(30, 74, 122, 0.12);">
                        <span style="font-size: 0.875rem; color: var(--muted-foreground);">Sensor ID</span>
                        <span style="font-size: 0.75rem; background: var(--muted); padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-family: monospace;">SFD-${sensor.id}</span>
                    </div>
                </div>

                <div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.875rem;">
                        <span style="color: var(--muted-foreground);">Water Level Progress</span>
                        <span style="font-weight: 600;">${waterLevelPercent.toFixed(0)}%</span>
                    </div>
                    <div style="height: 12px; background: #e0e0e0; border-radius: 6px; overflow: hidden;">
                        <div style="height: 100%; width: ${waterLevelPercent}%; background: ${progressColor}; transition: width 0.5s ease;"></div>
                    </div>
                </div>

                ${sensor.riskLevel === 'high' && sensor.status === 'online' ? `
                    <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(229, 57, 53, 0.1); border: 1px solid rgba(229, 57, 53, 0.3); border-radius: 0.5rem;">
                        <div style="display: flex; align-items: start; gap: 0.5rem;">
                            <i data-feather="alert-triangle" style="width: 16px; height: 16px; color: #e53935; flex-shrink: 0; margin-top: 0.125rem;"></i>
                            <p style="margin: 0; font-size: 0.875rem; color: #c62828;">
                                <strong>Critical Warning:</strong> Water level ${((sensor.waterLevel - 2.5) * 100).toFixed(0)}cm above threshold. Prepare for evacuation.
                            </p>
                        </div>
                    </div>
                ` : ''}
            `;

            feather.replace();

            if (map) {
                map.setView([sensor.lat, sensor.lng], 15, { animate: true });
                const marker = markers.find(m => m.sensorId === sensor.id);
                if (marker) marker.leafletMarker.openPopup();
            }
        }

        // Render all sensors list
        function renderAllSensors() {
            const container = document.getElementById('allSensorsList');
            if (!container) return;

            const html = sensors.map(s => `
                <div style="display: flex; flex-direction: column; gap: 0.5rem; padding: 0.75rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 0.5rem;">
                        <strong style="font-size: 0.9375rem;">${s.name}</strong>
                        <span class="risk-badge ${s.riskLevel}" style="font-size: 0.75rem; padding: 0.25rem 0.625rem;">${s.riskLevel.toUpperCase()}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem;">
                        <span style="font-size: 0.875rem; color: var(--muted-foreground);">${s.status === 'online' ? `${s.waterLevel.toFixed(1)}m` : 'Offline'}</span>
                        <button onclick="selectSensor(${s.id})" style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem; min-height: 36px;">
                            View Details
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        // Initialize Leaflet Map
        function initLeafletMap() {
            if (map) return;

            const mapElement = document.getElementById('leafletMap');
            if (!mapElement) return;

            map = L.map('leafletMap', {
                scrollWheelZoom: true,
                touchZoom: true,
                dragging: true
            }).setView([13.9411, 121.1634], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            sensors.forEach(sensor => {
                const riskColors = { high: '#e53935', medium: '#ffc107', low: '#8bc34a' };
                const pulseAnimation = sensor.riskLevel === 'high' && sensor.status === 'online' ? 'animation: marker-pulse 2s infinite;' : '';

                const iconHtml = `
                    <div style="width: 40px; height: 40px; border-radius: 50%; background: ${riskColors[sensor.riskLevel]}; border: 3px solid ${sensor.status === 'offline' ? '#999' : '#fff'}; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); display: flex; align-items: center; justify-content: center; cursor: pointer; ${pulseAnimation} opacity: ${sensor.status === 'offline' ? '0.5' : '1'};">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                    </div>
                `;

                const customIcon = L.divIcon({
                    html: iconHtml,
                    className: 'custom-marker',
                    iconSize: [40, 40],
                    iconAnchor: [20, 40],
                    popupAnchor: [0, -40]
                });

                const marker = L.marker([sensor.lat, sensor.lng], { icon: customIcon })
                    .addTo(map)
                    .bindPopup(`
                        <div style="font-family: system-ui, sans-serif; min-width: 180px;">
                            <h3 style="margin: 0 0 8px 0; font-size: 14px; font-weight: 600; color: #1e4a7a;">${sensor.name}</h3>
                            <div style="font-size: 12px; color: #546e7a; line-height: 1.6;">
                                <p style="margin: 4px 0;"><strong>Status:</strong> <span style="color: ${sensor.status === 'online' ? '#8bc34a' : '#999'};">${sensor.status}</span></p>
                                <p style="margin: 4px 0;"><strong>Water Level:</strong> ${sensor.waterLevel.toFixed(1)}m</p>
                                <p style="margin: 4px 0;"><strong>Risk:</strong> <span style="color: ${riskColors[sensor.riskLevel]}; text-transform: uppercase; font-weight: 600;">${sensor.riskLevel}</span></p>
                            </div>
                            <button onclick="selectSensor(${sensor.id})" style="margin-top: 8px; width: 100%; padding: 8px 12px; background: linear-gradient(135deg, #1e4a7a, #00bcd4); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 500;">View Details</button>
                        </div>
                    `)
                    .on('click', () => selectSensor(sensor.id));

                markers.push({ sensorId: sensor.id, leafletMarker: marker });
            });

            setTimeout(() => map.invalidateSize(), 200);
        }

        // Chart initialization
        function initDashboardCharts() {
            const rainfallCtx = document.getElementById('rainfallChart');
            if (rainfallCtx && !rainfallChart) {
                rainfallChart = new Chart(rainfallCtx, {
                    type: 'line',
                    data: {
                        labels: ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00'],
                        datasets: [{
                            label: 'Actual',
                            data: [2.4, 3.2, 5.1, 8.3, 12.5, 15.2, 11.8, 7.6],
                            borderColor: '#00bcd4',
                            backgroundColor: 'rgba(0, 188, 212, 0.1)',
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 3
                        }, {
                            label: 'Forecast',
                            data: [3.1, 4.2, 6.5, 9.2, 14.8, 18.5, 13.2, 8.4],
                            borderColor: '#8bc34a',
                            borderDash: [5, 5],
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'top', labels: { boxWidth: 20, padding: 10 } } },
                        scales: { y: { beginAtZero: true } }
                    }
                });
            }

            const waterLevelCtx = document.getElementById('waterLevelChart');
            if (waterLevelCtx && !waterLevelChart) {
                waterLevelChart = new Chart(waterLevelCtx, {
                    type: 'line',
                    data: {
                        labels: ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00'],
                        datasets: [{
                            label: 'Water Level',
                            data: [1.2, 1.4, 1.8, 2.1, 2.6, 2.9, 2.4, 2.0],
                            borderColor: '#1e4a7a',
                            backgroundColor: 'rgba(0, 188, 212, 0.2)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 2
                        }, {
                            label: 'Threshold',
                            data: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5],
                            borderColor: '#e53935',
                            borderDash: [5, 5],
                            borderWidth: 2,
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'top', labels: { boxWidth: 20, padding: 10 } } },
                        scales: { y: { beginAtZero: true } }
                    }
                });
            }
        }

        function initPredictionCharts() {
            const forecastCtx = document.getElementById('forecastChart');
            if (forecastCtx && !forecastChart) {
                forecastChart = new Chart(forecastCtx, {
                    type: 'line',
                    data: {
                        labels: ['Now', '+3h', '+6h', '+12h', '+24h', '+48h'],
                        datasets: [{
                            label: 'Predicted Risk',
                            data: [65, 72, 78, 85, 68, 45],
                            borderColor: '#e53935',
                            backgroundColor: 'rgba(229, 57, 53, 0.1)',
                            tension: 0.4,
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 3
                        }, {
                            label: 'Actual Risk',
                            data: [62, null, null, null, null, null],
                            borderColor: '#2563eb',
                            borderWidth: 2,
                            pointRadius: 4,
                            spanGaps: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'top', labels: { boxWidth: 20, padding: 10 } } },
                        scales: { y: { beginAtZero: true, max: 100 } }
                    }
                });
            }
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            feather.replace();
            renderPredictions();
            initDashboardCharts();
        });

        // Handle resize for map
        window.addEventListener('resize', () => {
            if (map) setTimeout(() => map.invalidateSize(), 200);
        });
    </script>
</body>
</html>
