<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Flood Detection System - National University Lipa</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- Feather Icons -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    <!-- Leaflet CSS/JS for interactive maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- Site Icon -->
    <link rel="icon" type="image/png" href="images/logo.png" />
    <link rel="apple-touch-icon" href="images/logo.png" />
    
    <style>
        /* Custom CSS Variables from your design */
        :root {
            --navy-blue: #1e4a7a;
            --bright-cyan: #00bcd4;
            --light-cyan: #4dd0e1;
            --mint-green: #8bc34a;
            --lime-green: #9ccc65;
            --background: #f5f9fc;
            --foreground: #1a2332;
            --primary: #1e4a7a;
            --secondary: #00bcd4;
            --accent: #8bc34a;
            --destructive: #e53935;
            --muted: #e8f4f8;
            --muted-foreground: #546e7a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(to bottom right, #f5f9fc, #f5f9fc, rgba(0, 188, 212, 0.05));
            min-height: 100vh;
        }

        .decorative-bg {
            position: fixed;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        .decorative-bg::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 384px;
            height: 384px;
            background: radial-gradient(circle, rgba(0, 188, 212, 0.15), transparent);
            filter: blur(80px);
        }

        .decorative-bg::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 384px;
            height: 384px;
            background: radial-gradient(circle, rgba(139, 195, 74, 0.15), transparent);
            filter: blur(80px);
        }

        .gradient-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }

        .metric-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-top: 4px solid transparent;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
            border-top-color: var(--secondary);
        }

        .chart-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--secondary);
        }

        .risk-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            border: 1px solid;
        }

        .risk-badge.low {
            background: rgba(139, 195, 74, 0.2);
            color: #689f38;
            border-color: rgba(139, 195, 74, 0.3);
        }

        .risk-badge.medium {
            background: rgba(255, 193, 7, 0.2);
            color: #f57c00;
            border-color: rgba(255, 193, 7, 0.3);
        }

        .risk-badge.high {
            background: rgba(229, 57, 53, 0.2);
            color: #c62828;
            border-color: rgba(229, 57, 53, 0.3);
        }

        .nav-button {
            padding: 0.625rem 1.25rem;
            border-radius: 0.5rem;
            border: none;
            background: transparent;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: all 0.2s;
            color: var(--foreground);
        }

        .nav-button:hover {
            background: rgba(255, 255, 255, 0.6);
        }

        .nav-button.active {
            background: linear-gradient(135deg, var(--primary), rgba(30, 74, 122, 0.9));
            color: white;
            box-shadow: 0 4px 12px rgba(30, 74, 122, 0.3);
        }

        .alert-box {
            padding: 1rem;
            border-radius: 0.5rem;
            border-left: 4px solid;
            margin-bottom: 1rem;
        }

        .alert-box.warning {
            background: linear-gradient(to right, rgba(255, 193, 7, 0.1), transparent);
            border-color: #ffc107;
        }

        .alert-box.info {
            background: linear-gradient(to right, rgba(0, 188, 212, 0.1), transparent);
            border-color: var(--secondary);
        }

        .sensor-marker {
            position: absolute;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sensor-marker:hover {
            transform: scale(1.2);
        }

        .sensor-marker.high {
            background: #e53935;
            border-color: #c62828;
            box-shadow: 0 0 20px rgba(229, 57, 53, 0.5);
            animation: pulse-red 2s infinite;
        }

        .sensor-marker.medium {
            background: #ffc107;
            border-color: #f57c00;
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.5);
        }

        .sensor-marker.low {
            background: #8bc34a;
            border-color: #689f38;
            box-shadow: 0 0 20px rgba(139, 195, 74, 0.5);
        }

        @keyframes pulse-red {
            0%, 100% {
                box-shadow: 0 0 20px rgba(229, 57, 53, 0.5);
            }
            50% {
                box-shadow: 0 0 40px rgba(229, 57, 53, 0.8);
            }
        }

        .hidden {
            display: none !important;
        }

        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .nav-desktop {
                display: none;
            }
        }

        @media (min-width: 769px) {
            .nav-mobile, .mobile-menu-toggle {
                display: none !important;
            }
        }

        /* Responsive fixes for inline style tokens */
        @media (min-width: 1024px) {
            #mapGrid {
                grid-template-columns: 2fr 1fr;
            }
            #footerFlex {
                flex-direction: row;
            }
        }

        /* Let vertical scroll pass through the map on touch devices */
        #leafletMap {
            touch-action: pan-y;
        }
        /* Default: let page scroll pass through the map */
        #leafletMap.disabled-interactions {
            pointer-events: none;
        }

        /* Leaflet custom styles */
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .leaflet-popup-tip {
            background: white;
        }
        .custom-marker {
            background: transparent;
            border: none;
        }
        
        @keyframes marker-pulse {
            0%, 100% {
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            }
            50% {
                box-shadow: 0 4px 20px rgba(229, 57, 53, 0.8), 0 0 0 8px rgba(229, 57, 53, 0.2);
            }
        }
    </style>
</head>
<body>
    <!-- Decorative Background -->
    <div class="decorative-bg"></div>

    <!-- Main Container -->
    <div style="position: relative; z-index: 1;">
        <!-- Header -->
        <header style="position: sticky; top: 0; z-index: 50; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(30, 74, 122, 0.12); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);">
            <div style="max-width: 1280px; margin: 0 auto; padding: 0 1rem;">
                <div style="display: flex; align-items: center; justify-content: space-between; height: 80px;">
                    <!-- Logo Section -->
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <img src="images/logo.png" 
                             alt="Smart Flood Logo" style="width: 56px; height: 56px;">
                        <div>
                            <h2 style="font-size: 1.25rem; color: var(--primary); font-weight: 600; margin: 0;">Smart Flood Detection</h2>
                            <p style="font-size: 0.75rem; color: var(--muted-foreground); margin: 0;">Philippine Monitoring System</p>
                        </div>
                    </div>
                    <!-- Mobile Menu Toggle -->
                    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" style="background: transparent; border: none; cursor: pointer; padding: 0.5rem;">
                        <i data-feather="menu" style="width: 24px; height: 24px;"></i>
                    </button>

                    <!-- Desktop Navigation -->
                    <nav class="nav-desktop" style="display: flex; align-items: center; gap: 0.5rem; background: rgba(232, 244, 248, 0.5); padding: 0.375rem; border-radius: 0.75rem;">
                        <button class="nav-button active" onclick="switchTab('dashboard')" id="nav-dashboard">
                            <i data-feather="layout" style="width: 16px; height: 16px;"></i>
                            Dashboard
                        </button>
                        <button class="nav-button" onclick="switchTab('map')" id="nav-map">
                            <i data-feather="map" style="width: 16px; height: 16px;"></i>
                            Map View
                        </button>
                        <button class="nav-button" onclick="switchTab('predictions')" id="nav-predictions">
                            <i data-feather="cpu" style="width: 16px; height: 16px;"></i>
                            Predictions
                        </button>
                        <button class="nav-button" onclick="switchTab('alerts')" id="nav-alerts">
                            <i data-feather="bell" style="width: 16px; height: 16px;"></i>
                            Alerts
                        </button>
                    </nav>
                </div>

                <!-- Mobile Navigation -->
                <div id="mobileMenu" class="nav-mobile hidden" style="border-top: 1px solid rgba(30, 74, 122, 0.12); padding: 1rem; background: #f5f9fc;">
                    <button class="nav-button active" onclick="switchTab('dashboard'); toggleMobileMenu();" style="width: 100%; justify-content: flex-start; margin-bottom: 0.5rem;">
                        <i data-feather="layout" style="width: 16px; height: 16px;"></i>
                        Dashboard
                    </button>
                    <button class="nav-button" onclick="switchTab('map'); toggleMobileMenu();" style="width: 100%; justify-content: flex-start; margin-bottom: 0.5rem;">
                        <i data-feather="map" style="width: 16px; height: 16px;"></i>
                        Map View
                    </button>
                    <button class="nav-button" onclick="switchTab('predictions'); toggleMobileMenu();" style="width: 100%; justify-content: flex-start; margin-bottom: 0.5rem;">
                        <i data-feather="cpu" style="width: 16px; height: 16px;"></i>
                        Predictions
                    </button>
                    <button class="nav-button" onclick="switchTab('alerts'); toggleMobileMenu();" style="width: 100%; justify-content: flex-start;">
                        <i data-feather="bell" style="width: 16px; height: 16px;"></i>
                        Alerts
                    </button>
                </div>

            </div>
        </header>

        <!-- Main Content -->
        <main style="max-width: 1280px; margin: 0 auto; padding: 2rem 1rem;">
            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content">
                <!-- Gradient Header -->
                <div class="gradient-header">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                        <i data-feather="droplet" style="width: 32px; height: 32px;"></i>
                        <h1 style="font-size: 1.875rem; margin: 0; color: white;">Smart Flood Detection Dashboard</h1>
                    </div>
                    <p style="margin: 0; opacity: 0.95;">Real-time monitoring and prediction for flood-prone areas in the Philippines</p>
                </div>

                <!-- Recent Alerts -->
                <div class="alert-box warning">
                    <div style="display: flex; align-items: start; gap: 0.75rem;">
                        <i data-feather="alert-triangle" style="width: 20px; height: 20px; color: #f57c00; flex-shrink: 0;"></i>
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 0.25rem 0; color: #f57c00;">Barangay San Jose</h4>
                            <p style="margin: 0; font-size: 0.875rem; color: var(--foreground);">High flood risk detected. Expected water level: 3.2m • 10 minutes ago</p>
                        </div>
                    </div>
                </div>

                <div class="alert-box info">
                    <div style="display: flex; align-items: start; gap: 0.75rem;">
                        <i data-feather="info" style="width: 20px; height: 20px; color: var(--secondary); flex-shrink: 0;"></i>
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 0.25rem 0; color: var(--secondary);">Barangay Poblacion</h4>
                            <p style="margin: 0; font-size: 0.875rem; color: var(--foreground);">Heavy rainfall forecast for next 6 hours • 25 minutes ago</p>
                        </div>
                    </div>
                </div>

                <!-- Metrics Grid -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Current Rainfall</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="cloud-rain" style="width: 20px; height: 20px; color: var(--secondary);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.875rem; font-weight: 600;">15.2 mm/hr</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: #e53935;">+23% from last hour</p>
                    </div>

                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Average Water Level</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="activity" style="width: 20px; height: 20px; color: var(--primary);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.875rem; font-weight: 600;">2.3 meters</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: #e53935;">Above normal threshold</p>
                    </div>

                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Active Sensors</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="radio" style="width: 20px; height: 20px; color: var(--accent);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.875rem; font-weight: 600;">12 / 15</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--muted-foreground);">3 sensors offline</p>
                    </div>

                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">High Risk Areas</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="alert-triangle" style="width: 20px; height: 20px; color: var(--destructive);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.875rem; font-weight: 600;">3 locations</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: #e53935;">2 new alerts today</p>
                    </div>
                </div>

                <!-- Charts -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div class="chart-card">
                        <div style="margin-bottom: 1rem;">
                            <h3 style="margin: 0 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                <i data-feather="cloud-rain" style="width: 20px; height: 20px; color: var(--secondary);"></i>
                                Rainfall Monitoring (24h)
                            </h3>
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Actual vs Forecasted Rainfall</p>
                        </div>
                        <canvas id="rainfallChart" style="max-height: 300px;"></canvas>
                    </div>

                    <div class="chart-card" style="border-left-color: var(--primary);">
                        <div style="margin-bottom: 1rem;">
                            <h3 style="margin: 0 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                <i data-feather="activity" style="width: 20px; height: 20px; color: var(--primary);"></i>
                                Water Level Monitoring (24h)
                            </h3>
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">River gauge readings and thresholds</p>
                        </div>
                        <canvas id="waterLevelChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>

                <!-- Predictions Table -->
                <div class="chart-card" style="border-left-color: var(--accent);">
                    <div style="margin-bottom: 1rem;">
                        <h3 style="margin: 0 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem;">
                            <i data-feather="cpu" style="width: 20px; height: 20px; color: var(--accent);"></i>
                            Flood Risk Predictions by Location
                        </h3>
                        <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">ML-based flood likelihood predictions for monitored areas</p>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem; transition: background 0.2s;" onmouseover="this.style.background='rgba(232, 244, 248, 0.5)'" onmouseout="this.style.background='transparent'">
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 0.5rem 0;">Barangay San Jose</h4>
                                <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                                    <span class="risk-badge high">
                                        <i data-feather="alert-triangle" style="width: 14px; height: 14px;"></i>
                                        High Risk
                                    </span>
                                    <span style="font-size: 0.875rem; color: var(--muted-foreground);">87% probability</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 128px; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 87%; background: #e53935;"></div>
                                </div>
                                <i data-feather="bell" style="width: 16px; height: 16px; color: var(--muted-foreground); cursor: pointer;"></i>
                            </div>
                        </div>

                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem; transition: background 0.2s;" onmouseover="this.style.background='rgba(232, 244, 248, 0.5)'" onmouseout="this.style.background='transparent'">
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 0.5rem 0;">Barangay Santa Cruz</h4>
                                <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                                    <span class="risk-badge medium">
                                        <i data-feather="alert-circle" style="width: 14px; height: 14px;"></i>
                                        Medium Risk
                                    </span>
                                    <span style="font-size: 0.875rem; color: var(--muted-foreground);">62% probability</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 128px; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 62%; background: #ffc107;"></div>
                                </div>
                                <i data-feather="bell" style="width: 16px; height: 16px; color: var(--muted-foreground); cursor: pointer;"></i>
                            </div>
                        </div>

                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem; transition: background 0.2s;" onmouseover="this.style.background='rgba(232, 244, 248, 0.5)'" onmouseout="this.style.background='transparent'">
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 0.5rem 0;">Barangay Poblacion</h4>
                                <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                                    <span class="risk-badge high">
                                        <i data-feather="alert-triangle" style="width: 14px; height: 14px;"></i>
                                        High Risk
                                    </span>
                                    <span style="font-size: 0.875rem; color: var(--muted-foreground);">78% probability</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 128px; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 78%; background: #e53935;"></div>
                                </div>
                                <i data-feather="bell" style="width: 16px; height: 16px; color: var(--muted-foreground); cursor: pointer;"></i>
                            </div>
                        </div>

                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem; transition: background 0.2s;" onmouseover="this.style.background='rgba(232, 244, 248, 0.5)'" onmouseout="this.style.background='transparent'">
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 0.5rem 0;">Barangay Riverside</h4>
                                <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                                    <span class="risk-badge low">
                                        <i data-feather="check-circle" style="width: 14px; height: 14px;"></i>
                                        Low Risk
                                    </span>
                                    <span style="font-size: 0.875rem; color: var(--muted-foreground);">34% probability</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 128px; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 34%; background: #8bc34a;"></div>
                                </div>
                                <i data-feather="bell" style="width: 16px; height: 16px; color: var(--muted-foreground); cursor: pointer;"></i>
                            </div>
                        </div>

                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem; transition: background 0.2s;" onmouseover="this.style.background='rgba(232, 244, 248, 0.5)'" onmouseout="this.style.background='transparent'">
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 0.5rem 0;">Barangay Central</h4>
                                <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                                    <span class="risk-badge medium">
                                        <i data-feather="alert-circle" style="width: 14px; height: 14px;"></i>
                                        Medium Risk
                                    </span>
                                    <span style="font-size: 0.875rem; color: var(--muted-foreground);">55% probability</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 128px; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 55%; background: #ffc107;"></div>
                                </div>
                                <i data-feather="bell" style="width: 16px; height: 16px; color: var(--muted-foreground); cursor: pointer;"></i>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Map Tab -->
            <div id="map-tab" class="tab-content hidden">
                <div class="gradient-header">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                        <i data-feather="map-pin" style="width: 32px; height: 32px;"></i>
                        <h1 style="font-size: 1.875rem; margin: 0; color: white;">Flood Risk Map</h1>
                    </div>
                    <p style="margin: 0; opacity: 0.95;">Interactive map showing sensor locations and real-time flood risk zones</p>
                </div>

                <div id="mapGrid" style="display: grid; grid-template-columns: 1fr; gap: 1.5rem;">
                    <!-- Map Card -->
                    <div class="chart-card">
                        <div style="margin-bottom: 1rem;">
                            <h3 style="margin: 0 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                <i data-feather="navigation" style="width: 20px; height: 20px; color: var(--secondary);"></i>
                                Sensor Network Map
                            </h3>
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Real-time sensor locations and status</p>
                        </div>
                        
                        <!-- Leaflet Map with small toggle to avoid blocking page scroll -->
                        <div id="mapWrapper" style="position: relative;">
                            <div id="leafletMap" style="height: 500px; border-radius: 0.5rem; overflow: hidden; border: 1px solid rgba(0, 188, 212, 0.2);"></div>
                        </div>
                    </div>

                    <!-- Sensor Details -->
                    <div class="chart-card" style="border-left-color: var(--primary);">
                        <div style="margin-bottom: 1rem;">
                            <h3 style="margin: 0 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                <i data-feather="radio" style="width: 20px; height: 20px; color: var(--primary);"></i>
                                Sensor Details
                            </h3>
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);" id="sensorDetailsDesc">Click on a sensor to view details</p>
                        </div>
                        
                        <div id="sensorDetails">
                            <div style="text-align: center; padding: 3rem 1rem; color: var(--muted-foreground);">
                                <i data-feather="map-pin" style="width: 48px; height: 48px; opacity: 0.5; margin: 0 auto 1rem;"></i>
                                <p style="margin: 0; font-size: 0.875rem;">Select a sensor on the map to view detailed information</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- All Sensors List -->
                <div class="chart-card" style="margin-top: 1.5rem;">
                    <div style="margin-bottom: 1rem;">
                        <h3 style="margin: 0 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem;">
                            <i data-feather="radio" style="width: 20px; height: 20px; color: var(--primary);"></i>
                            All Sensors
                        </h3>
                        <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Overview of all monitored sensors</p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr; gap: 0.75rem;" id="allSensorsList"></div>
                </div>
            </div>

            <!-- Predictions Tab -->
            <div id="predictions-tab" class="tab-content hidden">
                <div class="gradient-header">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                        <i data-feather="cpu" style="width: 32px; height: 32px;"></i>
                        <h1 style="font-size: 1.875rem; margin: 0; color: white;">ML Prediction Console</h1>
                    </div>
                    <p style="margin: 0; opacity: 0.95;">Machine learning model performance and flood forecasts</p>
                </div>

                <!-- Model Metrics -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Model Accuracy</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="target" style="width: 20px; height: 20px; color: var(--accent);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.875rem; font-weight: 600;">93.2%</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 93.2%; background: var(--accent);"></div>
                        </div>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--accent);">+2.3% from last month</p>
                    </div>

                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Predictions Today</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="activity" style="width: 20px; height: 20px; color: var(--secondary);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.875rem; font-weight: 600;">248</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--muted-foreground);">Running every 15 minutes</p>
                    </div>

                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Training Data</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="database" style="width: 20px; height: 20px; color: var(--primary);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.875rem; font-weight: 600;">15,432</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--muted-foreground);">Historical records</p>
                    </div>

                    <div class="metric-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Last Retrained</p>
                            <div style="background: var(--muted); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="calendar" style="width: 20px; height: 20px; color: #f57c00;"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.875rem; font-weight: 600;">3 days</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--muted-foreground);">Next: in 4 days</p>
                    </div>
                </div>

                <!-- Forecast Chart -->
                <div class="chart-card">
                    <div style="margin-bottom: 1rem;">
                        <h3 style="margin: 0 0 0.25rem 0;">48-Hour Flood Risk Forecast</h3>
                        <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">ML-based predictions for upcoming flood events</p>
                    </div>
                    <canvas id="forecastChart" style="max-height: 350px;"></canvas>
                </div>

                <!-- Model Info -->
                <div class="chart-card" style="margin-top: 1.5rem;">
                    <div style="margin-bottom: 1rem;">
                        <h3 style="margin: 0 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem;">
                            <i data-feather="cpu" style="width: 20px; height: 20px; color: var(--accent);"></i>
                            Model Information
                        </h3>
                        <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Current production model details</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div style="padding: 0.75rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem;">
                            <p style="margin: 0 0 0.25rem 0; font-size: 0.75rem; color: var(--muted-foreground);">Algorithm</p>
                            <p style="margin: 0;">XGBoost Classifier</p>
                        </div>
                        <div style="padding: 0.75rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem;">
                            <p style="margin: 0 0 0.25rem 0; font-size: 0.75rem; color: var(--muted-foreground);">Version</p>
                            <p style="margin: 0;">v2.4.1</p>
                        </div>
                        <div style="padding: 0.75rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem;">
                            <p style="margin: 0 0 0.25rem 0; font-size: 0.75rem; color: var(--muted-foreground);">Training Date</p>
                            <p style="margin: 0;">October 12, 2025</p>
                        </div>
                        <div style="padding: 0.75rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem;">
                            <p style="margin: 0 0 0.25rem 0; font-size: 0.75rem; color: var(--muted-foreground);">Training Samples</p>
                            <p style="margin: 0;">15,432 records</p>
                        </div>
                        <div style="padding: 0.75rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem;">
                            <p style="margin: 0 0 0.25rem 0; font-size: 0.75rem; color: var(--muted-foreground);">Features</p>
                            <p style="margin: 0;">24 input variables</p>
                        </div>
                        <div style="padding: 0.75rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem;">
                            <p style="margin: 0 0 0.25rem 0; font-size: 0.75rem; color: var(--muted-foreground);">Inference Time</p>
                            <p style="margin: 0;">~0.3 seconds</p>
                        </div>
                    </div>

                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(0, 188, 212, 0.1); border: 1px solid rgba(0, 188, 212, 0.2); border-radius: 0.5rem;">
                        <div style="display: flex; align-items: start; gap: 0.75rem;">
                            <i data-feather="cpu" style="width: 20px; height: 20px; color: var(--secondary); flex-shrink: 0; margin-top: 0.125rem;"></i>
                            <div>
                                <h4 style="margin: 0 0 0.5rem 0; font-size: 0.875rem;">Model Description</h4>
                                <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">
                                    The current production model uses gradient boosting to predict flood likelihood based on 
                                    meteorological data, water level sensors, and historical flood patterns. It's retrained 
                                    monthly with new data to maintain accuracy.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alerts Tab -->
            <div id="alerts-tab" class="tab-content hidden">
                <div class="gradient-header">
                    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <i data-feather="bell" style="width: 32px; height: 32px;"></i>
                                <h1 style="font-size: 1.875rem; margin: 0; color: white;">Alert Management</h1>
                            </div>
                            <p style="margin: 0; opacity: 0.95;">Manage and monitor flood warnings and notifications</p>
                        </div>
                        <button style="background: white; color: var(--primary); border: none; padding: 0.625rem 1.25rem; border-radius: 0.5rem; cursor: pointer; display: inline-flex; align-items: center; gap: 0.5rem; font-weight: 500;">
                            <i data-feather="settings" style="width: 16px; height: 16px;"></i>
                            Alert Settings
                        </button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                    <div class="metric-card" style="border-top-color: var(--destructive);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Active Alerts</p>
                            <div style="background: rgba(229, 57, 53, 0.1); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="bell" style="width: 20px; height: 20px; color: var(--destructive);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.875rem; font-weight: 600;">3</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--destructive);">2 critical alerts</p>
                    </div>

                    <div class="metric-card" style="border-top-color: var(--secondary);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Total Recipients</p>
                            <div style="background: rgba(0, 188, 212, 0.1); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="message-square" style="width: 20px; height: 20px; color: var(--secondary);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.875rem; font-weight: 600;">987</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--muted-foreground);">Across all locations</p>
                    </div>

                    <div class="metric-card" style="border-top-color: var(--accent);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Messages Sent (24h)</p>
                            <div style="background: rgba(139, 195, 74, 0.1); padding: 0.5rem; border-radius: 0.5rem;">
                                <i data-feather="mail" style="width: 20px; height: 20px; color: var(--accent);"></i>
                            </div>
                        </div>
                        <p style="margin: 0; font-size: 1.875rem; font-weight: 600;">1,254</p>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.75rem; color: var(--accent);">98.5% delivered</p>
                    </div>
                </div>

                <!-- Active Alerts List -->
                <div class="chart-card">
                    <div style="margin-bottom: 1rem;">
                        <h3 style="margin: 0 0 0.25rem 0;">Current Active Alerts</h3>
                        <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Real-time flood warnings requiring attention</p>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div class="alert-box" style="border-color: var(--destructive); background: linear-gradient(to right, rgba(229, 57, 53, 0.1), transparent);">
                            <div style="display: flex; align-items: start; gap: 0.75rem;">
                                <i data-feather="alert-triangle" style="width: 20px; height: 20px; color: var(--destructive); flex-shrink: 0; margin-top: 0.125rem;"></i>
                                <div style="flex: 1;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                        <h4 style="margin: 0; color: var(--destructive);">Barangay San Jose</h4>
                                        <span class="risk-badge high" style="font-size: 0.75rem; padding: 0.125rem 0.5rem;">HIGH</span>
                                    </div>
                                    <p style="margin: 0 0 0.5rem 0; font-size: 0.875rem;">Critical water level detected. Immediate evacuation recommended.</p>
                                    <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; font-size: 0.75rem; color: var(--muted-foreground);">
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            <i data-feather="clock" style="width: 12px; height: 12px;"></i>
                                            5 minutes ago
                                        </span>
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            <i data-feather="message-square" style="width: 12px; height: 12px;"></i>
                                            342 recipients
                                        </span>
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            SMS • Email • Push
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert-box" style="border-color: #ffc107; background: linear-gradient(to right, rgba(255, 193, 7, 0.1), transparent);">
                            <div style="display: flex; align-items: start; gap: 0.75rem;">
                                <i data-feather="alert-circle" style="width: 20px; height: 20px; color: #f57c00; flex-shrink: 0; margin-top: 0.125rem;"></i>
                                <div style="flex: 1;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                        <h4 style="margin: 0; color: #f57c00;">Barangay Santa Cruz</h4>
                                        <span class="risk-badge medium" style="font-size: 0.75rem; padding: 0.125rem 0.5rem;">MEDIUM</span>
                                    </div>
                                    <p style="margin: 0 0 0.5rem 0; font-size: 0.875rem;">Heavy rainfall forecast. Monitor water levels closely.</p>
                                    <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; font-size: 0.75rem; color: var(--muted-foreground);">
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            <i data-feather="clock" style="width: 12px; height: 12px;"></i>
                                            18 minutes ago
                                        </span>
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            <i data-feather="message-square" style="width: 12px; height: 12px;"></i>
                                            189 recipients
                                        </span>
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            SMS • Email
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert-box" style="border-color: var(--destructive); background: linear-gradient(to right, rgba(229, 57, 53, 0.1), transparent);">
                            <div style="display: flex; align-items: start; gap: 0.75rem;">
                                <i data-feather="alert-triangle" style="width: 20px; height: 20px; color: var(--destructive); flex-shrink: 0; margin-top: 0.125rem;"></i>
                                <div style="flex: 1;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                        <h4 style="margin: 0; color: var(--destructive);">Barangay Poblacion</h4>
                                        <span class="risk-badge high" style="font-size: 0.75rem; padding: 0.125rem 0.5rem;">HIGH</span>
                                    </div>
                                    <p style="margin: 0 0 0.5rem 0; font-size: 0.875rem;">Water level rising rapidly. Prepare for evacuation.</p>
                                    <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; font-size: 0.75rem; color: var(--muted-foreground);">
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            <i data-feather="clock" style="width: 12px; height: 12px;"></i>
                                            32 minutes ago
                                        </span>
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            <i data-feather="message-square" style="width: 12px; height: 12px;"></i>
                                            456 recipients
                                        </span>
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                            SMS • Email • Push
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer style="border-top: 1px solid rgba(30, 74, 122, 0.12); margin-top: 3rem; background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(8px); position: relative; z-index: 10;">
            <div style="max-width: 1280px; margin: 0 auto; padding: 2rem 1rem;">
                <div id="footerFlex" style="display: flex; flex-direction: column; align-items: center; justify-content: space-between; gap: 1rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <img src="images/logo.png" 
                             alt="Smart Flood Logo" style="width: 40px; height: 40px;">
                        <div>
                            <p style="margin: 0; font-size: 0.875rem;">© 2025 Smart Flood Detection System</p>
                            <p style="margin: 0; font-size: 0.75rem; color: var(--muted-foreground);">National University - Lipa</p>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">Capstone Project</p>
                        <p style="margin: 0; font-size: 0.75rem; color: var(--muted-foreground);">Alcantara • Hernandez • Tan • Viray</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Global map variable
        let map = null;
        let markers = [];

        // Tab Navigation
        function switchTab(tabName) {
            // Hide all tabs
            const tabs = ['dashboard', 'map', 'predictions', 'alerts'];
            tabs.forEach(tab => {
                document.getElementById(`${tab}-tab`).classList.add('hidden');
                document.getElementById(`nav-${tab}`).classList.remove('active');
                // Also update mobile nav buttons
                const mobileButtons = document.querySelectorAll('.nav-mobile button');
                mobileButtons.forEach(btn => {
                    if (btn.textContent.toLowerCase().includes(tab)) {
                        btn.classList.remove('active');
                    }
                });
            });

            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            document.getElementById(`nav-${tabName}`).classList.add('active');

            // Update icons
            feather.replace();

            // Initialize charts or map if needed
            if (tabName === 'dashboard') {
                initDashboardCharts();
            } else if (tabName === 'predictions') {
                initPredictionCharts();
            } else if (tabName === 'map') {
                // Render sensor list and initialize map
                renderAllSensors();
                setTimeout(() => {
                    initLeafletMap();
                }, 100);
            }
        }

        // Mobile Menu Toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
            feather.replace();
        }

        // Sensor Data - Updated for Lipa, Batangas area
        const sensors = [
            { id: 1, name: 'San Jose River Station', status: 'online', waterLevel: 2.8, riskLevel: 'high', lat: 13.9411, lng: 121.1634 },
            { id: 2, name: 'Santa Cruz Bridge', status: 'online', waterLevel: 1.9, riskLevel: 'medium', lat: 13.9475, lng: 121.1580 },
            { id: 3, name: 'Poblacion Center', status: 'offline', waterLevel: 0, riskLevel: 'low', lat: 13.9380, lng: 121.1700 },
            { id: 4, name: 'Riverside Park Sensor', status: 'online', waterLevel: 1.2, riskLevel: 'low', lat: 13.9520, lng: 121.1650 },
            { id: 5, name: 'Central Plaza Monitor', status: 'online', waterLevel: 2.1, riskLevel: 'medium', lat: 13.9350, lng: 121.1620 },
            { id: 6, name: 'Barangay Hall Sensor', status: 'online', waterLevel: 1.5, riskLevel: 'low', lat: 13.9450, lng: 121.1720 },
            { id: 7, name: 'Market Area Station', status: 'online', waterLevel: 2.4, riskLevel: 'high', lat: 13.9320, lng: 121.1580 }
        ];

        function selectSensor(sensorId) {
            const sensor = sensors.find(s => s.id === sensorId);
            if (!sensor) return;

            const detailsDiv = document.getElementById('sensorDetails');
            const descP = document.getElementById('sensorDetailsDesc');
            
            descP.textContent = 'Selected sensor information';

            const riskBadgeClass = sensor.riskLevel === 'high' ? 'high' : sensor.riskLevel === 'medium' ? 'medium' : 'low';
            const statusBadge = sensor.status === 'online' 
                ? '<span style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.75rem; background: rgba(0, 188, 212, 0.2); color: var(--secondary); border-radius: 9999px; font-size: 0.75rem; font-weight: 500;"><i data-feather="wifi" style="width: 12px; height: 12px;"></i> online</span>'
                : '<span style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.75rem; background: rgba(0, 0, 0, 0.1); color: var(--muted-foreground); border-radius: 9999px; font-size: 0.75rem; font-weight: 500;"><i data-feather="wifi-off" style="width: 12px; height: 12px;"></i> offline</span>';

            const riskBadge = `<span class="risk-badge ${riskBadgeClass}" style="font-size: 0.75rem;">${sensor.riskLevel.toUpperCase()} RISK</span>`;
            
            const waterLevelPercent = sensor.waterLevel > 0 ? Math.min((sensor.waterLevel / 2.5) * 100, 100) : 0;
            const progressColor = sensor.riskLevel === 'high' ? '#e53935' : sensor.riskLevel === 'medium' ? '#ffc107' : '#8bc34a';

            detailsDiv.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <h4 style="margin: 0 0 0.75rem 0;">${sensor.name}</h4>
                    <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.75rem;">
                        ${statusBadge}
                        ${riskBadge}
                    </div>
                </div>

                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(30, 74, 122, 0.12);">
                        <span style="font-size: 0.875rem; color: var(--muted-foreground);">Water Level</span>
                        <span style="font-weight: 600;">${sensor.waterLevel.toFixed(1)}m</span>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(30, 74, 122, 0.12);">
                        <span style="font-size: 0.875rem; color: var(--muted-foreground);">Critical Threshold</span>
                        <span style="font-weight: 600; color: #e53935;">2.5m</span>
                    </div>

                    <div style="display: flex; justify-content: space-between; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(30, 74, 122, 0.12);">
                        <span style="font-size: 0.875rem; color: var(--muted-foreground);">Normal Level</span>
                        <span style="font-weight: 600; color: #8bc34a;">1.5m</span>
                    </div>

                    <div style="display: flex; justify-content: space-between; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(30, 74, 122, 0.12);">
                        <span style="font-size: 0.875rem; color: var(--muted-foreground);">Coordinates</span>
                        <span style="font-size: 0.75rem; font-family: monospace;">${sensor.lat.toFixed(4)}°, ${sensor.lng.toFixed(4)}°</span>
                    </div>

                    <div style="display: flex; justify-content: space-between; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(30, 74, 122, 0.12);">
                        <span style="font-size: 0.875rem; color: var(--muted-foreground);"><i data-feather="clock" style="width: 12px; height: 12px; display: inline; vertical-align: middle;"></i> Last Update</span>
                        <span style="font-size: 0.875rem;">2 min ago</span>
                    </div>

                    <div style="display: flex; justify-content: space-between; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(30, 74, 122, 0.12);">
                        <span style="font-size: 0.875rem; color: var(--muted-foreground);">Sensor ID</span>
                        <span style="font-size: 0.75rem; background: var(--muted); padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-family: monospace;">SFD-${sensor.id}</span>
                    </div>
                </div>

                <div style="margin-top: 1rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.875rem;">
                        <span style="color: var(--muted-foreground);">Water Level Progress</span>
                        <span style="font-weight: 600;">${waterLevelPercent.toFixed(0)}%</span>
                    </div>
                    <div style="height: 12px; background: #e0e0e0; border-radius: 6px; overflow: hidden;">
                        <div style="height: 100%; width: ${waterLevelPercent}%; background: ${progressColor}; transition: width 0.5s ease;"></div>
                    </div>
                </div>

                ${sensor.riskLevel === 'high' && sensor.status === 'online' ? `
                    <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(229, 57, 53, 0.1); border: 1px solid rgba(229, 57, 53, 0.3); border-radius: 0.5rem;">
                        <div style="display: flex; align-items: start; gap: 0.5rem;">
                            <i data-feather="alert-triangle" style="width: 16px; height: 16px; color: #e53935; flex-shrink: 0; margin-top: 0.125rem;"></i>
                            <div>
                                <p style="margin: 0 0 0.25rem 0; font-size: 0.875rem; font-weight: 600; color: #e53935;">Critical Warning</p>
                                <p style="margin: 0; font-size: 0.875rem; color: #c62828;">
                                    Water level is ${sensor.waterLevel.toFixed(1)}m (${((sensor.waterLevel - 2.5) * 100).toFixed(0)}cm above threshold). 
                                    Residents should prepare for possible evacuation.
                                </p>
                            </div>
                        </div>
                    </div>
                ` : ''}

                ${sensor.status === 'offline' ? `
                    <div style="margin-top: 1rem; padding: 0.75rem; background: var(--muted); border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem;">
                        <div style="display: flex; align-items: start; gap: 0.5rem;">
                            <i data-feather="wifi-off" style="width: 16px; height: 16px; color: var(--muted-foreground); flex-shrink: 0; margin-top: 0.125rem;"></i>
                            <div>
                                <p style="margin: 0 0 0.25rem 0; font-size: 0.875rem; font-weight: 600; color: var(--muted-foreground);">Sensor Offline</p>
                                <p style="margin: 0; font-size: 0.875rem; color: var(--muted-foreground);">
                                    This sensor is currently offline. Last known data may not be current.
                                </p>
                            </div>
                        </div>
                    </div>
                ` : ''}
            `;

            feather.replace();

            // Pan map to sensor if map is initialized
            if (map) {
                map.setView([sensor.lat, sensor.lng], 15, { animate: true });
                // Open popup for selected marker
                const marker = markers.find(m => m.sensorId === sensor.id);
                if (marker) {
                    marker.leafletMarker.openPopup();
                }
            }
        }

        // Render All Sensors list in Map tab
        function renderAllSensors() {
            const container = document.getElementById('allSensorsList');
            if (!container) return;

            const riskBadge = (level) => {
                const cls = level === 'high' ? 'high' : level === 'medium' ? 'medium' : 'low';
                return `<span class="risk-badge ${cls}" style="font-size: 0.75rem;">${level.toUpperCase()}</span>`;
            };

            const statusBadge = (status) => {
                return status === 'online'
                    ? '<span style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.5rem; background: rgba(0, 188, 212, 0.15); color: var(--secondary); border-radius: 9999px; font-size: 0.75rem;"><i data-feather="wifi" style="width: 12px; height: 12px;"></i> online</span>'
                    : '<span style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.5rem; background: rgba(0,0,0,0.05); color: var(--muted-foreground); border-radius: 9999px; font-size: 0.75rem;"><i data-feather="wifi-off" style="width: 12px; height: 12px;"></i> offline</span>';
            };

            const rows = sensors.map(s => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border: 1px solid rgba(30, 74, 122, 0.12); border-radius: 0.5rem;">
                    <div style="display: flex; flex-direction: column; gap: 0.375rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
                            <strong>${s.name}</strong>
                            ${statusBadge(s.status)}
                            ${riskBadge(s.riskLevel)}
                        </div>
                        <div style="font-size: 0.875rem; color: var(--muted-foreground); display: flex; gap: 1rem; flex-wrap: wrap;">
                            <span>Water Level: <strong>${s.waterLevel.toFixed(1)}m</strong></span>
                            <span>Coords: <span style="font-family: monospace;">${s.lat.toFixed(4)}°, ${s.lng.toFixed(4)}°</span></span>
                        </div>
                    </div>
                    <div>
                        <button onclick="selectSensor(${s.id})" style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border: none; padding: 0.5rem 0.75rem; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem;">
                            View Details
                        </button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = rows;
            feather.replace();
        }

        // Initialize Leaflet Map
        function initLeafletMap() {
            if (map) return; // Already initialized

            const mapElement = document.getElementById('leafletMap');
            if (!mapElement) return;

            // Create map centered on Lipa, Batangas (limit interactions to avoid blocking page scroll)
            map = L.map('leafletMap', {
                scrollWheelZoom: false,
                touchZoom: false,
                dragging: false,
                keyboard: false,
                doubleClickZoom: false,
                boxZoom: false
            }).setView([13.9411, 121.1634], 13);

            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            // Keep Leaflet's default click handling so popups and close buttons work

            // Add sensor markers
            sensors.forEach(sensor => {
                const riskColors = {
                    high: '#e53935',
                    medium: '#ffc107',
                    low: '#8bc34a'
                };

                const pulseAnimation = sensor.riskLevel === 'high' && sensor.status === 'online' 
                    ? 'animation: marker-pulse 2s infinite;' 
                    : '';

                // Create custom icon
                const iconHtml = `
                    <div style="
                        width: 40px;
                        height: 40px;
                        border-radius: 50%;
                        background: ${riskColors[sensor.riskLevel]};
                        border: 3px solid ${sensor.status === 'offline' ? '#999' : '#fff'};
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        cursor: pointer;
                        ${pulseAnimation}
                        opacity: ${sensor.status === 'offline' ? '0.5' : '1'};
                    ">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                    </div>
                `;

                const customIcon = L.divIcon({
                    html: iconHtml,
                    className: 'custom-marker',
                    iconSize: [40, 40],
                    iconAnchor: [20, 40],
                    popupAnchor: [0, -40]
                });

                const marker = L.marker([sensor.lat, sensor.lng], { icon: customIcon })
                    .addTo(map)
                    .bindPopup(`
                        <div style="font-family: system-ui, sans-serif; min-width: 200px;">
                            <h3 style="margin: 0 0 8px 0; font-size: 14px; font-weight: 600; color: #1e4a7a;">
                                ${sensor.name}
                            </h3>
                            <div style="font-size: 12px; color: #546e7a; line-height: 1.6;">
                                <p style="margin: 4px 0;">
                                    <strong>Status:</strong> 
                                    <span style="color: ${sensor.status === 'online' ? '#8bc34a' : '#999'};">
                                        ${sensor.status}
                                    </span>
                                </p>
                                <p style="margin: 4px 0;">
                                    <strong>Water Level:</strong> ${sensor.waterLevel.toFixed(1)}m
                                </p>
                                <p style="margin: 4px 0;">
                                    <strong>Risk:</strong> 
                                    <span style="color: ${riskColors[sensor.riskLevel]}; text-transform: uppercase; font-weight: 600;">
                                        ${sensor.riskLevel}
                                    </span>
                                </p>
                            </div>
                            <button 
                                onclick="selectSensor(${sensor.id})"
                                style="
                                    margin-top: 8px;
                                    width: 100%;
                                    padding: 6px 12px;
                                    background: linear-gradient(135deg, #1e4a7a, #00bcd4);
                                    color: white;
                                    border: none;
                                    border-radius: 4px;
                                    cursor: pointer;
                                    font-size: 12px;
                                    font-weight: 500;
                                "
                            >
                                View Details
                            </button>
                        </div>
                    `)
                    .on('click', () => {
                        selectSensor(sensor.id);
                    });

                markers.push({ sensorId: sensor.id, leafletMarker: marker });
            });

            // Map is permanently non-interactive by design to allow page scroll.
            // Users can still view details via the All Sensors list; selectSensor() will pan programmatically.

            // Force resize after a short delay
            setTimeout(() => {
                map.invalidateSize();
            }, 200);
        }

        // Chart Initialization
        let rainfallChart, waterLevelChart, forecastChart;

        function initDashboardCharts() {
            // Rainfall Chart
            const rainfallCtx = document.getElementById('rainfallChart');
            if (rainfallCtx && !rainfallChart) {
                rainfallChart = new Chart(rainfallCtx, {
                    type: 'line',
                    data: {
                        labels: ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00'],
                        datasets: [{
                            label: 'Actual',
                            data: [2.4, 3.2, 5.1, 8.3, 12.5, 15.2, 11.8, 7.6],
                            borderColor: '#00bcd4',
                            backgroundColor: 'rgba(0, 188, 212, 0.1)',
                            tension: 0.4,
                            borderWidth: 3,
                            pointRadius: 4,
                            pointBackgroundColor: '#00bcd4'
                        }, {
                            label: 'Forecast',
                            data: [3.1, 4.2, 6.5, 9.2, 14.8, 18.5, 13.2, 8.4],
                            borderColor: '#8bc34a',
                            backgroundColor: 'rgba(139, 195, 74, 0.1)',
                            tension: 0.4,
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 3,
                            pointBackgroundColor: '#8bc34a'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'mm/hr'
                                }
                            }
                        }
                    }
                });
            }

            // Water Level Chart
            const waterLevelCtx = document.getElementById('waterLevelChart');
            if (waterLevelCtx && !waterLevelChart) {
                waterLevelChart = new Chart(waterLevelCtx, {
                    type: 'line',
                    data: {
                        labels: ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00'],
                        datasets: [{
                            label: 'Water Level',
                            data: [1.2, 1.4, 1.8, 2.1, 2.6, 2.9, 2.4, 2.0],
                            borderColor: '#1e4a7a',
                            backgroundColor: 'rgba(0, 188, 212, 0.2)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 2
                        }, {
                            label: 'Threshold',
                            data: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5],
                            borderColor: '#e53935',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'meters'
                                }
                            }
                        }
                    }
                });
            }
        }

        function initPredictionCharts() {
            const forecastCtx = document.getElementById('forecastChart');
            if (forecastCtx && !forecastChart) {
                forecastChart = new Chart(forecastCtx, {
                    type: 'line',
                    data: {
                        labels: ['Now', '+3h', '+6h', '+12h', '+24h', '+48h'],
                        datasets: [{
                            label: 'Predicted Risk',
                            data: [65, 72, 78, 85, 68, 45],
                            borderColor: '#e53935',
                            backgroundColor: 'rgba(229, 57, 53, 0.1)',
                            tension: 0.4,
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 4,
                            pointBackgroundColor: '#e53935'
                        }, {
                            label: 'Actual Risk',
                            data: [62, null, null, null, null, null],
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.4,
                            borderWidth: 3,
                            pointRadius: 5,
                            pointBackgroundColor: '#2563eb',
                            spanGaps: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Risk %'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            feather.replace();
            initDashboardCharts();
        });

        // Handle window resize for map
        window.addEventListener('resize', () => {
            if (map) {
                setTimeout(() => {
                    map.invalidateSize();
                }, 200);
            }
        });
    </script>
    
  </body>
  </html>
